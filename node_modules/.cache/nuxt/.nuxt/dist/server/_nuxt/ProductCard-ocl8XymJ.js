import { o as useI18n, n as useAppConfig, c as _export_sfc, p as useRoute, u as useCart, e as __nuxt_component_10, f as _sfc_main$2 } from "../server.mjs";
import { defineComponent, computed, unref, mergeProps, useSSRContext, ref, watch, withCtx, openBlock, createBlock, createCommentVNode, createVNode, createTextVNode, toDisplayString } from "vue";
import { ssrRenderAttrs, ssrInterpolate, ssrRenderComponent } from "vue/server-renderer";
import { _ as _sfc_main$3 } from "./ProductPrice-DLaqSb6r.js";
const _sfc_main$1 = /* @__PURE__ */ defineComponent({
  __name: "SaleBadge",
  __ssrInlineRender: true,
  props: {
    node: { type: Object, required: true }
  },
  setup(__props) {
    const { t } = useI18n();
    const { storeSettings } = useAppConfig();
    const salePercentage = computed(() => {
      var _a, _b, _c, _d;
      if (!((_a = __props.node) == null ? void 0 : _a.rawSalePrice) || !((_b = __props.node) == null ? void 0 : _b.rawRegularPrice)) return "";
      const salePrice = parseFloat((_c = __props.node) == null ? void 0 : _c.rawSalePrice);
      const regularPrice = parseFloat((_d = __props.node) == null ? void 0 : _d.rawRegularPrice);
      return Math.round((salePrice - regularPrice) / regularPrice * 100) + ` %`;
    });
    const showSaleBadge = computed(() => __props.node.rawSalePrice && storeSettings.saleBadge !== "hidden");
    const textToDisplay = computed(() => {
      if ((storeSettings == null ? void 0 : storeSettings.saleBadge) === "percent") return salePercentage.value;
      return t("messages.shop.onSale") ? t("messages.shop.onSale") : "Sale";
    });
    return (_ctx, _push, _parent, _attrs) => {
      if (unref(showSaleBadge)) {
        _push(`<span${ssrRenderAttrs(mergeProps({ class: "red-badge" }, _attrs))} data-v-395a4e44>${ssrInterpolate(unref(textToDisplay))}</span>`);
      } else {
        _push(`<!---->`);
      }
    };
  }
});
const _sfc_setup$1 = _sfc_main$1.setup;
_sfc_main$1.setup = (props, ctx) => {
  const ssrContext = useSSRContext();
  (ssrContext.modules || (ssrContext.modules = /* @__PURE__ */ new Set())).add("woonuxt_base/app/components/productElements/SaleBadge.vue");
  return _sfc_setup$1 ? _sfc_setup$1(props, ctx) : void 0;
};
const __nuxt_component_0 = /* @__PURE__ */ _export_sfc(_sfc_main$1, [["__scopeId", "data-v-395a4e44"]]);
const _sfc_main = /* @__PURE__ */ defineComponent({
  __name: "ProductCard",
  __ssrInlineRender: true,
  props: {
    node: { type: Object, required: true },
    index: { type: Number, default: 1 }
  },
  setup(__props) {
    var _a, _b, _c, _d;
    const route = useRoute();
    useAppConfig();
    useCart();
    const props = __props;
    const filterQuery = ref((_a = route.query) == null ? void 0 : _a.filter);
    const paColor = ref(((_d = (_c = (_b = filterQuery.value) == null ? void 0 : _b.split("pa_color[")[1]) == null ? void 0 : _c.split("]")[0]) == null ? void 0 : _d.split(",")) || []);
    watch(
      () => route.query,
      () => {
        var _a2, _b2, _c2;
        filterQuery.value = route.query.filter;
        paColor.value = ((_c2 = (_b2 = (_a2 = filterQuery.value) == null ? void 0 : _a2.split("pa_color[")[1]) == null ? void 0 : _b2.split("]")[0]) == null ? void 0 : _c2.split(",")) || [];
      }
    );
    const mainImage = computed(() => {
      var _a2, _b2, _c2, _d2;
      return ((_b2 = (_a2 = props.node) == null ? void 0 : _a2.image) == null ? void 0 : _b2.producCardSourceUrl) || ((_d2 = (_c2 = props.node) == null ? void 0 : _c2.image) == null ? void 0 : _d2.sourceUrl) || "/images/placeholder.jpg";
    });
    const imagetoDisplay = computed(() => {
      var _a2, _b2, _c2, _d2, _e, _f;
      if (paColor.value.length) {
        const activeColorImage = (_b2 = (_a2 = props.node) == null ? void 0 : _a2.variations) == null ? void 0 : _b2.nodes.filter((variation) => {
          var _a3;
          const hasMatchingAttributes = (_a3 = variation.attributes) == null ? void 0 : _a3.nodes.some((attribute) => paColor.value.some((color) => {
            var _a4;
            return (_a4 = attribute == null ? void 0 : attribute.value) == null ? void 0 : _a4.includes(color);
          }));
          const hasMatchingSlug = paColor.value.some((color) => {
            var _a4;
            return (_a4 = variation.slug) == null ? void 0 : _a4.includes(color);
          });
          return hasMatchingAttributes || hasMatchingSlug;
        });
        if (activeColorImage == null ? void 0 : activeColorImage.length) return ((_d2 = (_c2 = activeColorImage[0]) == null ? void 0 : _c2.image) == null ? void 0 : _d2.producCardSourceUrl) || ((_f = (_e = activeColorImage[0]) == null ? void 0 : _e.image) == null ? void 0 : _f.sourceUrl) || mainImage.value;
      }
      return mainImage.value;
    });
    return (_ctx, _push, _parent, _attrs) => {
      const _component_NuxtLink = __nuxt_component_10;
      const _component_NuxtImg = _sfc_main$2;
      const _component_SaleBadge = __nuxt_component_0;
      const _component_ProductPrice = _sfc_main$3;
      _push(`<div${ssrRenderAttrs(mergeProps({ class: "flex flex-col gap-[20px]" }, _attrs))}>`);
      if (__props.node.slug) {
        _push(ssrRenderComponent(_component_NuxtLink, {
          to: `/product/${decodeURIComponent(__props.node.slug)}`,
          title: __props.node.name,
          class: "w-full max-h-[216px] relative overflow-hidden grow-0"
        }, {
          default: withCtx((_, _push2, _parent2, _scopeId) => {
            var _a2, _b2, _c2, _d2;
            if (_push2) {
              if (unref(imagetoDisplay)) {
                _push2(ssrRenderComponent(_component_NuxtImg, {
                  src: unref(imagetoDisplay),
                  alt: ((_a2 = __props.node.image) == null ? void 0 : _a2.altText) || __props.node.name || "Product image",
                  title: ((_b2 = __props.node.image) == null ? void 0 : _b2.title) || __props.node.name,
                  loading: __props.index <= 3 ? "eager" : "lazy",
                  class: "object-cover w-full h-full transition hover:scale-105 duration-300",
                  placeholder: "",
                  "placeholder-class": "blur-xl"
                }, null, _parent2, _scopeId));
              } else {
                _push2(`<!---->`);
              }
              _push2(ssrRenderComponent(_component_SaleBadge, {
                node: __props.node,
                class: "absolute top-2 right-2"
              }, null, _parent2, _scopeId));
            } else {
              return [
                unref(imagetoDisplay) ? (openBlock(), createBlock(_component_NuxtImg, {
                  key: 0,
                  src: unref(imagetoDisplay),
                  alt: ((_c2 = __props.node.image) == null ? void 0 : _c2.altText) || __props.node.name || "Product image",
                  title: ((_d2 = __props.node.image) == null ? void 0 : _d2.title) || __props.node.name,
                  loading: __props.index <= 3 ? "eager" : "lazy",
                  class: "object-cover w-full h-full transition hover:scale-105 duration-300",
                  placeholder: "",
                  "placeholder-class": "blur-xl"
                }, null, 8, ["src", "alt", "title", "loading"])) : createCommentVNode("", true),
                createVNode(_component_SaleBadge, {
                  node: __props.node,
                  class: "absolute top-2 right-2"
                }, null, 8, ["node"])
              ];
            }
          }),
          _: 1
        }, _parent));
      } else {
        _push(`<!---->`);
      }
      _push(ssrRenderComponent(_component_NuxtLink, {
        class: "text-[20px] font-bold uppercase hover:text-stone-700 transition",
        to: `/product/${decodeURIComponent(__props.node.slug)}`,
        title: __props.node.name
      }, {
        default: withCtx((_, _push2, _parent2, _scopeId) => {
          if (_push2) {
            _push2(`${ssrInterpolate(__props.node.name)}`);
          } else {
            return [
              createTextVNode(toDisplayString(__props.node.name), 1)
            ];
          }
        }),
        _: 1
      }, _parent));
      _push(ssrRenderComponent(_component_ProductPrice, {
        class: "text-sm",
        "sale-price": __props.node.salePrice,
        "regular-price": __props.node.regularPrice
      }, null, _parent));
      _push(`<div class="text-[14px] leading-[150%] flex-1">${__props.node.shortDescription ?? ""}</div>`);
      if (__props.node.slug) {
        _push(ssrRenderComponent(_component_NuxtLink, {
          to: `/product/${decodeURIComponent(__props.node.slug)}`,
          title: __props.node.name,
          class: "w-full button button-primary"
        }, {
          default: withCtx((_, _push2, _parent2, _scopeId) => {
            if (_push2) {
              _push2(`MEGRENDELÉS`);
            } else {
              return [
                createTextVNode("MEGRENDELÉS")
              ];
            }
          }),
          _: 1
        }, _parent));
      } else {
        _push(`<!---->`);
      }
      _push(`</div>`);
    };
  }
});
const _sfc_setup = _sfc_main.setup;
_sfc_main.setup = (props, ctx) => {
  const ssrContext = useSSRContext();
  (ssrContext.modules || (ssrContext.modules = /* @__PURE__ */ new Set())).add("woonuxt_base/app/components/productElements/ProductCard.vue");
  return _sfc_setup ? _sfc_setup(props, ctx) : void 0;
};
export {
  _sfc_main as _,
  __nuxt_component_0 as a
};
//# sourceMappingURL=ProductCard-ocl8XymJ.js.map
