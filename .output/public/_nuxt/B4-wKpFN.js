import{d as ae,O as le,y as de,m as re,N as ie,K as p,I as c,P as ce,J as ue,ad as me,Q as _e,o as l,c as r,b as s,h as b,F as f,a as u,w as U,e,t as o,i,r as pe,_ as fe,g as he,k as ge,n as ye}from"./B33GKiR2.js";import{_ as ve,a as xe}from"./ByOYZIjI.js";import{O as be}from"./XnHHUoS2.js";const we={class:"w-full min-h-[600px] flex items-center p-4 text-stone-800 md:bg-white md:rounded-xl md:mx-auto md:shadow-lg md:my-24 md:mt-8 md:max-w-3xl md:p-16 flex-col"},ke={key:0,class:"w-full"},$e={key:0,class:"flex items-center gap-4"},Ie={class:"text-xl font-semibold"},Te={class:"flex items-center justify-between w-full mb-2"},je={class:"text-xl font-semibold"},Ce={key:1,class:"flex-1 w-full"},Le={class:"flex items-start justify-between"},Me={class:"w-[21%]"},De={class:"mb-2 text-xs text-stone-400 uppercase"},Oe={class:"leading-none"},Pe={class:"w-[21%]"},Be={class:"mb-2 text-xs text-stone-400 uppercase"},Ne={class:"leading-none"},Se={class:"w-[21%]"},Ee={class:"mb-2 text-xs text-stone-400 uppercase"},Re={class:"w-[21%]"},qe={class:"mb-2 text-xs text-stone-400 uppercase"},Fe={class:"leading-none"},Ge={class:"grid gap-2"},He={class:"flex-1 leading-tight"},Ve={class:"text-sm text-stone-600"},ze={class:"text-sm font-semibold"},Qe={key:1},Ue={class:"flex justify-between"},Ae={class:"flex justify-between"},Je={class:"flex justify-between"},Ke={key:0,class:"flex justify-between text-primary"},We={class:"flex justify-between"},Xe={class:""},Ye={class:"font-semibold"},Ze={key:2,class:"flex flex-col items-center justify-center flex-1 w-full gap-4 text-center"},es=["innerHTML"],ss=2500,ls=ae({__name:"order-summary",setup(ts){const{query:_,params:A,name:w}=le(),{customer:J}=de(),{formatDate:K,formatPrice:W}=re(),{t:k}=ie(),a=p(null),X=p(_.fetch_delay==="true"),h=p(!1),m=p(""),Y=c(()=>{var t;return!((t=J.value)!=null&&t.email)}),$=c(()=>w==="order-summary"),g=c(()=>w==="order-received"),y=c(()=>{var t;return((t=a.value)==null?void 0:t.status)!==be.COMPLETED}),Z=c(()=>{var t;return!!parseFloat(((t=a.value)==null?void 0:t.rawDiscountTotal)||"0")}),I=c(()=>{var t,n;return((n=(t=a.value)==null?void 0:t.downloadableItems)==null?void 0:n.nodes)||[]});ce(()=>{g.value&&(_.cancel_order||_.from_paypal||_.PayerID)&&window.close()}),ue(async()=>{await v(),g.value&&X.value&&y.value&&setTimeout(()=>{v()},ss)});async function v(){var t;try{const n=await me({id:A.orderId});n.order?a.value=n.order:m.value="Could not find order"}catch(n){m.value=((t=n==null?void 0:n.gqlErrors)==null?void 0:t[0].message)||"Could not find order"}h.value=!0}const ee=async()=>{h.value=!1,await v()};return _e({title(){return $.value?k("messages.shop.orderSummary"):k("messages.shop.orderReceived")}}),(t,n)=>{const se=ge,x=fe,T=he,te=ve,oe=ye,ne=xe;return l(),r("div",we,[s(h)?(l(),r(f,{key:1},[s(a)?(l(),r("div",ke,[s($)?(l(),r("div",$e,[u(T,{to:"/my-account?tab=orders",class:"inline-flex items-center justify-center p-2 border rounded-md",title:"Back to orders","aria-label":"Back to orders"},{default:U(()=>[u(x,{name:"ion:chevron-back-outline"})]),_:1}),e("h1",Ie,o(t.$t("messages.shop.orderSummary")),1)])):s(g)?(l(),r(f,{key:1},[e("div",Te,[e("h1",je,o(t.$t("messages.shop.orderReceived")),1),s(y)?(l(),r("button",{key:0,type:"button",class:"inline-flex items-center justify-center p-2 bg-white border rounded-md",title:"Refresh order","aria-label":"Refresh order",onClick:ee},[u(x,{name:"ion:refresh-outline"})])):i("",!0)]),e("p",null,o(t.$t("messages.shop.orderThanks")),1)],64)):i("",!0),n[0]||(n[0]=e("hr",{class:"my-8"},null,-1))])):i("",!0),s(a)&&!s(Y)?(l(),r("div",Ce,[e("div",Le,[e("div",Me,[e("div",De,o(t.$t("messages.shop.order")),1),e("div",Oe,"#"+o(s(a).databaseId),1)]),e("div",Pe,[e("div",Be,o(t.$t("messages.general.date")),1),e("div",Ne,o(s(K)(s(a).date)),1)]),e("div",Se,[e("div",Ee,o(t.$t("messages.general.status")),1),s(a).status?(l(),b(te,{key:0,order:s(a)},null,8,["order"])):i("",!0)]),e("div",Re,[e("div",qe,o(t.$t("messages.general.paymentMethod")),1),e("div",Fe,o(s(a).paymentMethodTitle),1)])]),s(a).lineItems?(l(),r(f,{key:0},[n[1]||(n[1]=e("hr",{class:"my-8"},null,-1)),e("div",Ge,[(l(!0),r(f,null,pe(s(a).lineItems.nodes,d=>{var j,C,L,M;return l(),r("div",{key:d.id,class:"flex items-center justify-between gap-8"},[(j=d.product)!=null&&j.node?(l(),b(T,{key:0,to:`/product/${d.product.node.slug}`},{default:U(()=>{var D,O,P,B,N,S,E,R,q,F,G,H,V,z,Q;return[u(oe,{class:"w-16 h-16 rounded-xl",src:((P=(O=(D=d.variation)==null?void 0:D.node)==null?void 0:O.image)==null?void 0:P.sourceUrl)||((N=(B=d.product.node)==null?void 0:B.image)==null?void 0:N.sourceUrl)||"/images/placeholder.png",alt:((R=(E=(S=d.variation)==null?void 0:S.node)==null?void 0:E.image)==null?void 0:R.altText)||((F=(q=d.product.node)==null?void 0:q.image)==null?void 0:F.altText)||"Product image",title:((V=(H=(G=d.variation)==null?void 0:G.node)==null?void 0:H.image)==null?void 0:V.title)||((Q=(z=d.product.node)==null?void 0:z.image)==null?void 0:Q.title)||"Product image",width:"64",height:"64",loading:"lazy"},null,8,["src","alt","title"])]}),_:2},1032,["to"])):i("",!0),e("div",He,o(d.variation?(L=(C=d.variation)==null?void 0:C.node)==null?void 0:L.name:(M=d.product)==null?void 0:M.node.name),1),e("div",Ve,"Qty. "+o(d.quantity),1),e("span",ze,o(s(W)(d.total)),1)])}),128))])],64)):i("",!0),n[4]||(n[4]=e("hr",{class:"my-8"},null,-1)),s(I).length&&!s(y)?(l(),r("div",Qe,[u(ne,{"downloadable-items":s(I)},null,8,["downloadable-items"]),n[2]||(n[2]=e("hr",{class:"my-8"},null,-1))])):i("",!0),e("div",null,[e("div",Ue,[e("span",null,o(t.$t("messages.shop.subtotal")),1),e("span",null,o(s(a).subtotal),1)]),e("div",Ae,[e("span",null,o(t.$t("messages.general.tax")),1),e("span",null,o(s(a).totalTax),1)]),e("div",Je,[e("span",null,o(t.$t("messages.general.shipping")),1),e("span",null,o(s(a).shippingTotal),1)]),s(Z)?(l(),r("div",Ke,[e("span",null,o(t.$t("messages.shop.discount")),1),e("span",null,"- "+o(s(a).discountTotal),1)])):i("",!0),n[3]||(n[3]=e("hr",{class:"my-8"},null,-1)),e("div",We,[e("span",Xe,o(t.$t("messages.shop.total")),1),e("span",Ye,o(s(a).total),1)])])])):s(m)?(l(),r("div",Ze,[u(x,{name:"ion:sad-outline",size:"96",class:"text-stone-700"}),n[5]||(n[5]=e("h1",{class:"text-xl font-semibold"},"Error",-1)),s(m)?(l(),r("div",{key:0,class:"text-sm text-red-500",innerHTML:s(m)},null,8,es)):i("",!0)])):i("",!0)],64)):(l(),b(se,{key:0,class:"flex-1"}))])}}});export{ls as default};
